تعال اقولك بسرعه ليه اوقات بيكون احسن اننا نستخدم stored procedure
مبدايا الـ stored procedure هى عباره عن شويه sql statements بتكون compiled و بتـ perform a specific task.

قبل ما اقولك ليه اوقات بيكون افضل انك تستخدم SP خلينا الاول نعرف الـ execute بتاع الـ query بيبقى عامل ازاى.
الquery لما بيروح للـ engine بيمر بـ cycle معينه وهى:
= اول حاجه بتحصل هى الـ parsing و فى المرحله دى هو بيتاكد من syntax بتاع الـ query مكتوب صح ولا لا.
= بعد كده الـ optimize هنا هو بيتاكد من الـ metadata يعنى انت لو بترجع id , name من تابل اسمه student ف هو بيروح يتأكد من الـ cols دى موجودة ولا لا جوا الـschema .
=الـ query tree هنا بيتحدد الـ query بيتنفذ ازاى لان مش دايما الكويرى بيتنفذ زى ما بيتكتب، هو بيبقى عنده optimizer بينظم الـ run بتاع الـ query و يشوف بقى هيرن الـ join ولا sub query الاول و هكذا.
= الـ execute planهنا بيعمل execute للـ query ويبدأ ينقل الداتا جوا الميمورى.
الـ cycle دى بتحصل كل مره بترن فيها query حتى لو كان نفس الـ query هيروح يكرر نفس الخطوات دى تانى، طبعا الكلام دا مع حجم الداتا الكبير هياخد وقت كبير جدا و هياثر على preformance بتاعك وعشان كده اخترعوا db object اسمه Stored procedure، انت بتـ create الـ SP و تحط جواها query بتاعك و لما تحب تعمله run مش محتاج اكتر من انك تـ call الـ SP و تبعتلها الـ parameters بتاعتها لو بتاخد.

طيب برضو فايده الكلام دا ايه ؟
قالك أن cycle الطويله بتاعه الـ run دى بتحصل مع اول call للـ procedure بس و بيجى عند الخطوه بتاعه query tree بيروح عامل save للـ tree of query جوا الـ sql يعنى بيعمل زى table method و يـ save جواه أن الـ SP إلى اسمها X بتتنفذ بالطريقة دى مثلا لو الـ query إلى جوا SP هو بيـ select الـ row إلى id بتاعه رقم 4
select * from student where Id = 4
ف هو هيروح يحفظ أن SP دى بتتنفذ الـ from الاول وبعدين where و بعدين select
لما تيجى تعمل run لنفس SP دى تانى مبيعملش run cycle من الاول لا هو خلاص لا محتاج يعمل parsing ولا optimize ولا query tree هو بيروح يشوف الـ SP دى بتتنفذ ازاى و يبدأ يعملها execute جوا engine.

خلينا نكمل باقى benefits بمثال
لو عندك مثلا app فيه 2 text boxes بتدخل فيهم id , name مثلا و عندك button عاوز لما تدوس عليه save الاسم و id ف انت لو مش هتستخدم SP ف الكود إلى هيكون موجود فىbutton هو جملهinsert وطبعا دا كده ك security wise مش صح لانك بتتعامل مع اسماء tables على طول و كمان network wise مش حلو لأن حجم characters كده كتير و خصوصا لو استخدمت sub query، غير كده انت كل مره هتدوس فيها على button هيروح ينفذ الكويرى من الاول خالص و هيخلى preformance مش احسن حاجه غير كل دا انت مثلا لو دخلت id هو موجود بالفعل قبل كده هيطلع ايرور فى sql و ساعتها الايرور هيضرب app إلى انت شغال عليه لكن مثلا لو استخدمت SP هتقدر تهندل الايرور دا ب if condition انها ترجع للapp رقم معين ف ساعتها انت تعرف أنت تعرف أن ف ايرور حصل من غير ما تضرب app.

ف SP بتخلى الpredormance بتاعك احسن
بتعلى الـ security عشان مش بتتعامل مع اسامى object على طول، كمان بتخفى business rules بتاعتك بمعنى أن لو فيه ديفلوبر عايز الكويرى بتاع المرتبات هو بيروح يشوف الps لكن ملهوش دعوه الى جواها مكتوب ازاى، بتقلل Characters على نتورك بتالى أدائها بيكون احسن، بتمنع حدوث الايرور على سيرفر لأنك بتقدر تهندلها جوا SP.